#Base image
MAINTAINER haniokasai <htek@haniokasai.com>

FROM ubuntu:latest

ENV DEBIAN_FRONTEND=noninteractive

# RUN: when image is being built
RUN echo "BUILDING PROCESS"
RUN apt update
RUN apt install bash pure-ftpd

RUN mkdir /minecraft
RUN mkdir /minecraft/multiphar
RUN mkdir /minecraft/resources
RUN mkdir /minecraft/bin
#serverフォルダはバックアップする
RUN mkdir /minecraft/server

#Copy& extract Bin
ADD ./resources/*  /minecraft/resources/
RUN tar zxvf /minecraft/resources/PHP-7.3-Linux-x86_64.tar.gz /minecraft/bin
WORKDIR /minecraft/resources

#FTP prepare
RUN sh pre-FTP.sh

#BDS and Cuberite and ...
RUN sh pre-BE-BDS.sh
RUN sh pre-BE-Cuberite.sh
RUN sh pre-Java-Minecraft.sh
RUN sh pre-Java-Spigot.sh


#PORT
##FTP
EXPOSE 21/tcp
##Minecraft
EXPOSE 19132/udp
##Cuberite Admin
EXPOSE 80


#Minecraft and FTP
WORKDIR /minecraft/server
#TODO background, mochikomi.phar or not
CMD sh /minecraft/resources/runsever.sh && /minecraft/resources/run-PureFTPD.sh
